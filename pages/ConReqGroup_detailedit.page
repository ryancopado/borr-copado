<apex:page standardController="Con_Req_Group__c" tabStyle="Con_Req_Group__c" lightningStylesheets="true" extensions="ConReqGroupControllerExt" id="thePage">
    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">
        var j$ = jQuery.noConflict();
        function disableButtons(label) {
            j$('.btn').each(function(elem) {
                this.className = 'btnDisabled';
                this.disabled = true;
                this.value = label;
            })
        }
    </script>
    
    <script type="text/javascript">
        function deletelineconfirm(solId) {
            var sol = solId;
            var r = confirm("Are you sure?");
            if (r == true) {
                deleteline(sol);
            }
        }
        
        function deletegroupconfirm() {
            var r = confirm("Are you sure?");
            if (r == true) {
                deletegrp();
            }
        }
        
        function unlockrecord() {
            if ((Modal.confirm && Modal.confirm('Are you sure?')) || (!Modal.confirm && window.confirm('Are you sure?'))) {
                navigateToUrl('/_ui/core/entitylock/LockHandler?id={!crGroup.Id}&un=1');
                cleargrplock();
            }
        }
    </script>
    
    <apex:form id="theForm">
        
        <apex:actionfunction name="cleargrplock" action="{!clearLock}" reRender="theForm"/>
        
        <apex:actionfunction name="deletegrp" action="{!delete}" reRender="theForm"/>

        <apex:actionfunction name="deleteline" action="{!deleteSolLine}" reRender="theForm">
            <apex:param assignTo="{!deleteSolId}" value="" name="deleteSolId"/>
        </apex:actionfunction>
        
        <apex:actionStatus id="saveStatus" onstart="disableButtons('Saving...')"/>
        
        <apex:pageMessages />
        <apex:sectionHeader title="Con Req Group" subtitle="{!crGroup.Name}"/>
        
        <apex:pageBlock id="theGroupView" title="Con Req Group Detail" mode="detail" rendered="{!!editGrp && !isServiceVisit}">
            <apex:pageBlockButtons location="top">
                <apex:outputPanel rendered="{!crGroup.IsLocked__c}">
                    <img src="/img/lock_small.gif" alt="Locked" title="Locked" height="16" width="16"></img>
                    <apex:outputPanel rendered="{!modifyAll}">
                        <input value="Unlock Record" class="btn" name="unlock" onclick="unlockrecord();" title="Unlock Record" type="button" />
                    </apex:outputPanel>
                </apex:outputPanel>
                <apex:commandButton value="Edit" action="{!editGroup}" immediate="true"/>
                <apex:commandButton value="Delete" onclick="deletegroupconfirm();return false;"/>
                <apex:commandButton value="Submit for Approval" action="{!submitGroup}"/>
                <apex:commandButton value="Recall Approved" action="{!recallApproved}" rendered="{!crGroup.Status__c == 'Approved'}"/>
        <!--  commented on 1/23/2019 (MG) mass attach file was not working
              <apex:outputLink value="/apex/dropzone__AttachFiles?id={!crGroup.Id}" styleClass="btn" style="text-decoration:none;padding:3px 4px;">Mass Attach Files</apex:outputLink> -->
            </apex:pageBlockButtons>
            <apex:pageBlockSection columns="2">
                <apex:outputField value="{!crGroup.Name}"/>
                <apex:outputField value="{!crGroup.OwnerId}"/>
                <apex:outputField value="{!crGroup.Status__c}"/>
                <apex:outputField value="{!crGroup.Requisition_Total_Roll_Up__c}"/>
                <apex:outputField value="{!crGroup.OK_to_Submit__c}"/>
                <!-- <apex:outputField value="{!crGroup.Remaining_Available_Budget_Roll_Up__c}"/> -->
                 
                
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Construction Requisition Group Information" columns="2" collapsible="false">
                <apex:outputField value="{!crGroup.Project__c}"/>
                <apex:outputField value="{!crGroup.Ship_to_Account__c}" />
                <apex:outputField value="{!crGroup.Sales_Order__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Site__c}" />
                <apex:outputField value="{!crGroup.Project_PM__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Street__c}"/>
                <apex:outputField value="{!crGroup.Requested_Delivery_Date__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_City__c}"/>
                <apex:outputField value="{!crGroup.Tax_Group_Percent__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_State__c}"/>
                <apex:outputField value="{!crGroup.Vendor__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Zip__c}"/>
                <apex:outputField value="{!crGroup.Vendor_Contact__c}"/>
                <apex:outputField value="{!crGroup.Contact__c}"/>
                <apex:outputField value="{!crGroup.Business_Days_Allowed__c}"/>
                <apex:outputField value="{!crGroup.Failure_to_make_payment_consequences__c}"/>
                <apex:outputField value="{!crGroup.Deadline_Date__c}"/>
                <apex:outputField value="{!crGroup.Other__c}"/>
                <apex:outputField value="{!crGroup.OpportunityStage__c}"/>
                <apex:outputField value="{!crGroup.TotalRequisitionCoststoDate__c}"/>
                <apex:outputField value="{!crGroup.ProjectKickoffDate__c}"/>
                <apex:outputField value="{!crGroup.Non_Customer_CO_s__c}"/>
                <apex:pageBlockSectionItem />
                <apex:outputField value="{!crGroup.X7C_Submittal_Date__c}"/>
                
                 
                 
                 
               
                
                
                
                
                
            </apex:pageBlockSection>
            
            <apex:pageBlockSection title="Check Request Information" columns="1" collapsible="false">
                <apex:outputField value="{!crGroup.Check_Request__c}"/>
                <apex:outputField value="{!crGroup.Distribution_Method__c}" />
                <apex:outputField value="{!crGroup.Check_Instructions__c}"/>
                <apex:outputField value="{!crGroup.CheckRequestDescription__c}"/>
                <apex:outputField value="{!crGroup.Payee_Address_State__c}" />
                <apex:outputField value="{!crGroup.Payee_Address_City__c}"/>
                <apex:outputField value="{!crGroup.Payee_Address_Street__c}"/>
                <apex:outputField value="{!crGroup.Payee_Postal_Code__c}"/>
            </apex:pageBlockSection>
                
              <apex:pageBlockSection >
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!crGroup.CreatedBy.Name}"/>,&nbsp;<apex:outputField value="{!crGroup.CreatedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!crGroup.LastModifiedBy.Name}"/>,&nbsp;<apex:outputField value="{!crGroup.LastModifiedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
            </apex:pageBlockSection>
        
        <apex:pageBlockSection title="Docusign Information" columns="1" collapsible="false">
        <apex:outputField value="{!crGroup.Docusign_Needed__c}"/>
         <apex:outputField value="{!crGroup.External_Recipients_and_Order__c}"/>
          <apex:outputField value="{!crGroup.Brief_Description_of_Document__c }"/>
            <apex:outputField value="{!crGroup.Pages_Where_Signature_is_Required__c }"/>
           <apex:outputField value="{!crGroup.Internal_Signatories_and_order__c }"/> 
       
        </apex:pageBlockSection>
         </apex:pageBlock>
        
        <apex:pageBlock id="theGroupEdit" title="Con Req Group Edit" mode="edit" rendered="{!editGrp && !isServiceVisit}">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Save" action="{!saveGroup}"/>
                <apex:commandButton value="Cancel" action="{!cancelGroup}" immediate="true"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection title="Information" columns="2">
                <apex:inputField value="{!crGroup.Status__c}"/>
                <apex:inputField value="{!crGroup.Requisition_Total_Roll_Up__c}"/>
                 
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Construction Requisition Group Information" columns="2" collapsible="false">
                <apex:inputField value="{!crGroup.Project__c}" required="true"/>
                <apex:inputField value="{!crGroup.Ship_to_Account__c}" required="true"/>
                <apex:outputField value="{!crGroup.Sales_Order__c}" />
                <apex:inputField value="{!crGroup.Ship_To_Site__c}" required="true"/>
                <apex:outputField value="{!crGroup.Project_PM__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Street__c}"/>
                <apex:inputField value="{!crGroup.Requested_Delivery_Date__c}" required="true"/>
                <apex:outputField value="{!crGroup.Ship_To_City__c}"/>
                <apex:inputField value="{!crGroup.Tax_Group__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_State__c}"/>
                <apex:inputField value="{!crGroup.Vendor__c}" required="true"/>
                <apex:outputField value="{!crGroup.Ship_To_Zip__c}"/>
                <apex:inputField value="{!crGroup.Vendor_Contact__c}" required="true"/>
                <apex:inputField value="{!crGroup.Contact__c}"/>
                <apex:inputField value="{!crGroup.Business_Days_Allowed__c}"/>
                <apex:inputField value="{!crGroup.Failure_to_make_payment_consequences__c}"/>
                <apex:inputField value="{!crGroup.Deadline_Date__c}"/>
                <apex:inputField value="{!crGroup.Other__c}"/>
                <apex:inputField value="{!crGroup.OpportunityStage__c}"/>
                <apex:inputField value="{!crGroup.TotalRequisitionCoststoDate__c}"/>
                <apex:inputField value="{!crGroup.ProjectKickoffDate__c}"/>
                <apex:inputField value="{!crGroup.X7C_Submittal_Date__c}"/>
                <apex:inputField value="{!crGroup.ROD__c}"/>
                 
                
                
                
            </apex:pageBlockSection>
                
         <apex:pageBlockSection title="Check Request Information" columns="1" collapsible="false">
                <apex:inputField value="{!crGroup.Check_Request__c}"/>
                <apex:inputField value="{!crGroup.Distribution_Method__c}" />
                <apex:inputField value="{!crGroup.Check_Instructions__c}"/>
                <apex:inputField value="{!crGroup.CheckRequestDescription__c}"/>
                <apex:inputField value="{!crGroup.Payee_Address_State__c}" />
                <apex:inputField value="{!crGroup.Payee_Address_City__c}"/>
                <apex:inputField value="{!crGroup.Payee_Address_Street__c}"/>
                <apex:inputField value="{!crGroup.Payee_Postal_Code__c}"/>
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Docusign Information" columns="1" collapsible="false">
        <apex:inputField value="{!crGroup.Docusign_Needed__c}"/>
         <apex:inputField value="{!crGroup.External_Recipients_and_Order__c}"/>
          <apex:inputField value="{!crGroup.Brief_Description_of_Document__c }"/>
            <apex:inputField value="{!crGroup.Pages_Where_Signature_is_Required__c }"/>
             <apex:inputField value="{!crGroup.Internal_Signatories_and_order__c }"/> 
       
        </apex:pageBlockSection>
         </apex:pageBlock>
        
        <apex:pageBlock id="theGroupView2" title="Con Req Group Detail" mode="detail" rendered="{!!editGrp && isServiceVisit}">
            <apex:pageBlockButtons location="top">
                <apex:outputPanel rendered="{!crGroup.IsLocked__c}">
                    <img src="/img/lock_small.gif" alt="Locked" title="Locked" height="16" width="16"></img>
                    <apex:outputPanel rendered="{!modifyAll}">
                        <input value="Unlock Record" class="btn" name="unlock" onclick="unlockrecord();" title="Unlock Record" type="button" />
                    </apex:outputPanel>
                </apex:outputPanel>
                <apex:commandButton value="Edit" action="{!editGroup}" immediate="true"/>
                <apex:commandButton value="Delete" onclick="deletegroupconfirm();return false;"/>
                <apex:commandButton value="Submit for Approval" action="{!submitGroup}"/>
                <apex:commandButton value="Recall Approved" action="{!recallApproved}" rendered="{!crGroup.Status__c == 'Approved'}"/>
                <apex:outputLink value="/apex/dropzone__AttachFiles?id={!crGroup.Id}" styleClass="btn" style="text-decoration:none;padding:3px 4px;">Mass Attach Files</apex:outputLink>
            </apex:pageBlockButtons>
            <apex:pageBlockSection columns="2">
                <apex:outputField value="{!crGroup.Name}"/>
                <apex:outputField value="{!crGroup.OwnerId}"/>
               <!--  <apex:outputField value="{!crGroup.ServiceVisit__c}"/> field disabled for the same story 5/7/19 MG-->
                <apex:outputField value="{!crGroup.Status__c}"/>
                <apex:outputField value="{!crGroup.Sales_Order__c}"/>
                <apex:outputField value="{!crGroup.Requisition_Total_Roll_Up__c}"/>
                <apex:outputField value="{!crGroup.Project__c}"/>
                <apex:outputField value="{!crGroup.Ship_to_Account__c}" />
                <apex:outputField value="{!crGroup.O_M_Manager__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Contact__c}" />
                <apex:outputField value="{!crGroup.Vendor__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Contact_Phone__c}" />
                <apex:outputField value="{!crGroup.Vendor_Contact__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Street__c}"/>
                <apex:outputField value="{!crGroup.Requested_Delivery_Date__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_City__c}"/>
               
                <apex:outputField value="{!crGroup.Ship_To_State__c}"/>
                <apex:outputField value="{!crGroup.WorkOrder__c}"/>  <!-- Work order field added for the story on 5/7/19 MG -->
                
                <apex:outputField value="{!crGroup.Ship_To_Zip__c}"/>
                <apex:outputField value="{!crGroup.Case__c}"/><!-- case order field added for the story on 5/10/19 DK -->
                <apex:outputField value="{!crGroup.Quote__c}"/><br></br>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!crGroup.CreatedBy.Name}"/>,&nbsp;<apex:outputField value="{!crGroup.CreatedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!crGroup.LastModifiedBy.Name}"/>,&nbsp;<apex:outputField value="{!crGroup.LastModifiedDate}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </apex:pageBlock>
        
        <apex:pageBlock id="theGroupEdit2" title="Con Req Group Edit" mode="edit" rendered="{!editGrp && isServiceVisit}">
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Save" action="{!saveGroup}"/>
                <apex:commandButton value="Cancel" action="{!cancelGroup}" immediate="true"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection title="Information" columns="2">
                <!--  <apex:inputField value="{!crGroup.ServiceVisit__c}"/> field disabled for the same story 5/7/19 MG-->
                <apex:inputField value="{!crGroup.Status__c}"/>
                <apex:outputField value="{!crGroup.Sales_Order__c}" />
                <apex:outputField value="{!crGroup.Requisition_Total_Roll_Up__c}"/>
                <apex:inputField value="{!crGroup.Project__c}" required="true"/>
                <apex:inputField value="{!crGroup.Ship_to_Account__c}"/>
                <apex:outputField value="{!crGroup.O_M_Manager__c}"/>
                <apex:inputField value="{!crGroup.Ship_To_Contact__c}" required="true"/>
                <apex:inputField value="{!crGroup.Vendor__c}"/>
                <apex:outputField value="{!crGroup.Ship_To_Contact_Phone__c}" />
                <apex:inputField value="{!crGroup.Vendor_Contact__c}"/>
                <apex:inputField value="{!crGroup.Ship_To_Street__c}" required="true"/>
                <apex:inputField value="{!crGroup.Requested_Delivery_Date__c}"/>
                <apex:inputField value="{!crGroup.Ship_To_City__c}" required="true"/>
                <apex:pageBlockSectionItem />
                
                <apex:inputField value="{!crGroup.Ship_To_State__c}" required="true"/>
                <apex:inputField value="{!crGroup.WorkOrder__c}"/> <!-- Work order field added for the story on 5/7/19 MG -->
                <apex:inputField value="{!crGroup.Case__c}"/><!-- case order field added for the story on 5/10/19 DK -->
                <apex:inputField value="{!crGroup.Ship_To_Zip__c}" required="true"/>                
                <apex:inputField value="{!crGroup.Quote__c}" required="true"/>
                <apex:pageBlockSectionItem />
            </apex:pageBlockSection>
        </apex:pageBlock>
        
        
        
        <apex:pageBlock title="Construction Requisition Lines" id="theLineBlock">
            <apex:pageBlockButtons >
                <apex:commandButton value="New" action="{!addSolLine}" rendered="{!!selectRecordTypeLine && !addReqLine && !editAllReqs}" />
                <apex:commandButton value="View All" action="{!detailAllSolLines}" rendered="{!!selectRecordTypeLine && !addReqLine && !editAllReqs && !noSalesOrderLines && !viewAllReqs}"/>
                <apex:commandButton value="Edit All" action="{!editAllSolLines}" immediate="true" rendered="{!!selectRecordTypeLine && !addReqLine && !editAllReqs && !noSalesOrderLines}"/>
                <!--
                <apex:commandButton value="Save All" action="{!saveAllSolLines}" rendered="{!editAllReqs && !selectRecordTypeLine}" id="saveAll" onclick="disableButtons('saveAll')"/>
                -->
                <apex:commandButton value="Save All" action="{!saveAllSolLines}" rendered="{!editAllReqs && !selectRecordTypeLine}" id="saveAll" />
                <apex:commandButton value="Cancel All" action="{!cancelAllSolLines}" immediate="true" rendered="{!(viewAllReqs || editAllReqs) && !selectRecordTypeLine}"/>
                <apex:commandButton value="Select" action="{!selectSolRecordType}" rendered="{!selectRecordTypeLine}" />
                <apex:commandButton value="Cancel" action="{!cancelSolRecordType}" rendered="{!selectRecordTypeLine}" immediate="true" />
            </apex:pageBlockButtons>
            
            <apex:pageBlockSection columns="1" rendered="{!selectRecordTypeLine}">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Select Record Type"/>
                    <apex:selectList value="{!solRTSelected}" multiselect="false" size="1">
                        <apex:selectOptions value="{!solRecordTypes}"/>
                    </apex:selectList>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            
            <br/>
            <br/>
            
            <apex:outputPanel rendered="{!!noSalesOrderLines}" id="theTable">
                
                <table width="100%">
                    <tr style="border-bottom:1px solid black; padding:0.2em">
                        <th height="25">
                            Action
                        </th>
                        <th height="25">
                            Con Req Name
                        </th>
                        <th height="25">
                            Line Item
                        </th>
                        <th height="25">
                            Product
                        </th>
                        <th height="25">
                            Site
                        </th>
                        <th  height="25">
                            Quantity Ordered
                        </th>
                        <th  height="25">
                            Unit Cost
                        </th>
                        <th  height="25">
                            Sales Tax
                        </th>
                        <apex:outputPanel rendered="{!!isServiceVisit}">
                            <th  height="25">
                                Freight
                            </th>
                        </apex:outputPanel>
                        <th  height="25">
                            SOLine Total
                        </th>
                        <th  height="25">
                            Remaining Available Budget
                        </th>
                        <th  height="25">
                            Purchase Order Line
                        </th>
                    </tr>
                    
                    <apex:outputPanel id="theRepeatPanel" >
                    <apex:repeat value="{!crLineList}" var="item" >
                    
                        <apex:outputPanel rendered="{!item.isSummary}">
                        <tr>
                            <td height="25">
                                
                                <apex:commandLink action="{!editSolLine}" value="Edit" immediate="true" styleClass="btn" style="text-decoration:
                                e;padding:4px;margin-top:2px;margin-bottom:2px;margin-right:2px;">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                <apex:outputLink onclick="deletelineconfirm('{!item.crLine.Id}');return false;" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;">Delete</apex:outputLink>
                                <apex:commandLink action="{!cloneSolLine}" value="Clone" immediate="true" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                
                            </td>
                            <td height="25" >
                             <!--
                                <apex:commandLink action="{!detailSolLine}" value="{!item.crLine.Name}" onmouseover="LookupHoverDetail.getHover('{!item.crLine.Id})'/{!item.crLine.Id}/m?retURL={!item.crLine.Id}&isAjaxRequest=1').show();"> 
                                        <apex:param name="solId" value="{!item.crLine.Id}" />
                                </apex:commandLink>
                                <apex:outputField value="{!item.crLine.Name}"/>-->
                                <a href="/{!item.crLine.Id}" id="{!item.crLine.Id}" onblur="LookupHoverDetail.getHover('{!item.crLine.Id}').hide();" onfocus="LookupHoverDetail.getHover('{!item.crLine.Id}', '/{!item.crLine.Id}/m?retURL=%2F{!item.crLine.Id}&isAjaxRequest=1').show();" onmouseout="LookupHoverDetail.getHover('{!item.crLine.Id}').hide();" onmouseover="LookupHoverDetail.getHover('{!item.crLine.Id}', '/{!item.crLine.Id}/m?retURL=%2F{!item.crLine.Id}&isAjaxRequest=1').show();">{!item.crLine.Name}</a>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.AcctSeedERP__Project_Task__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.AcctSeedERP__Product__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.Site__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.Unit_Cost__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.Sales_Tax__c}"/>
                            </td>
                            <apex:outputPanel rendered="{!!isServiceVisit}">
                                <td height="25" >
                                    <apex:outputField value="{!item.crLine.Freight__c}"/>
                                </td>
                            </apex:outputPanel>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.SOLine_Total__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.Remaining_Available_Budget__c}"/>
                            </td>
                            <td height="25" >
                                <apex:outputField value="{!item.crLine.AcctSeedERP__Purchase_Order_Line__c}"/>
                            </td>
                        </tr>
                        
                        </apex:outputPanel>
                        
                        <apex:outputPanel rendered="{!!item.isSummary && item.isDetail}">
                            <tr>
                            <td>
                                <apex:commandLink action="{!editSolLine}" value="Edit" immediate="true" styleClass="btn" style="text-decoration:none;padding:4px;margin-top:2px;margin-bottom:2px;margin-right:2px;">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                <apex:commandLink action="{!cloneSolLine}" value="Clone" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                <apex:commandLink action="{!cancelSolLine}" value="Cancel" immediate="true" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                
                            </td>
                            <td colspan="11">
                                <apex:pageBlock title="{!item.crLine.Name}" mode="detail" rendered="{!!isServiceVisit}">
                                    <apex:pageBlockSection columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Project_Task__c}"/>
                                        <apex:outputField value="{!item.crLine.Backcharge__c}"/>
                                        <apex:outputField value="{!item.crLine.Development_Cost__c}"/>
                                        <apex:outputField value="{!item.crLine.Backcharge_To__c}"/>
                                        <apex:outputField value="{!item.crLine.Development_Cost_Line_Item__c}"/>
                                        <apex:outputField value="{!item.crLine.Tax_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.Not_To_Exceed__c}"/>
                                        <apex:outputField value="{!item.crLine.Sales_Tax_Rate_Percent__c}"/>
                                        <apex:outputField value="{!item.crLine.Remaining_Available_Budget__c}"/>
                                        <apex:outputField value="{!item.crLine.Total_Spent_Req__c}"/>
                                        <apex:outputField value="{!item.crLine.Con_Req_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.RecordTypeId}"/>
                                        <apex:outputField value="{!item.crLine.Site__c}"/>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection title="Product Information" columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Product__c}"/>
                                        <apex:outputField value="{!item.crLine.Racking_Watts__c}" rendered="{!!isServiceVisit}"/>
                                        <apex:outputField value="{!item.crLine.Unit_Cost__c}" rendered="{!isServiceVisit}"/>
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}"/>
                                        <apex:outputField value="{!item.crLine.Unit_Cost__c}" rendered="{!!isServiceVisit}"/>
                                        <apex:outputField value="{!item.crLine.Freight__c}" rendered="{!!isServiceVisit}"/>
                                        <apex:outputField value="{!item.crLine.Sales_Tax__c}"/>
                                        <apex:outputField value="{!item.crLine.SOLine_Total__c}"/>
                                        
                                        
                                        
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection columns="1" collapsible="false">
                                        <apex:outputField value="{!item.crLine.Vendor_Description_SOL__c}"/>
                                        <apex:outputField value="{!item.crLine.Additional_Notes__c}"/>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection title="Procurement Information" columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Purchase_Order_Line__c}"/>
                                        <apex:outputField value="{!item.crLine.Watts__c}"/>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection title="System Information" columns="2" collapsible="false">
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="Created By"/>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!item.crLine.CreatedBy.Name}"/>,&nbsp;<apex:outputField value="{!item.crLine.CreatedDate}"/>
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="Last Modified By"/>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!item.crLine.LastModifiedBy.Name}"/>,&nbsp;<apex:outputField value="{!item.crLine.LastModifiedDate}"/>
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                                
                                <apex:pageBlock title="{!item.crLine.Name}" mode="detail" rendered="{!isServiceVisit}">
                                    <apex:pageBlockSection columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.Name}"/>
                                        <apex:outputField value="{!item.crLine.Status__c}"/>
                                        <apex:outputField value="{!item.crLine.Con_Req_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.RecordTypeId}"/>
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Project__c}"/>
                                        <apex:outputField value="{!item.crLine.Tax_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Project_Task__c}"/>
                                        <apex:outputField value="{!item.crLine.Sales_Tax_Rate_Percent__c}"/>
                                        <apex:outputField value="{!item.crLine.Tax_Category__c}"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:outputField value="{!item.crLine.Unit_Cost__c}"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:outputField value="{!item.crLine.AcctSeedERP__Product__c}"/>
                                        <apex:outputField value="{!item.crLine.Sub_vendor_Account__c }" />
                                        <apex:pageBlockSectionItem />
                                        <apex:outputField value="{!item.crLine.Not_To_Exceed__c}"/>
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection columns="1" collapsible="false">
                                        <apex:outputField value="{!item.crLine.Additional_Notes__c}"/>
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection title="System Information" columns="2" collapsible="false">
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="Created By"/>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!item.crLine.CreatedBy.Name}"/>,&nbsp;<apex:outputField value="{!item.crLine.CreatedDate}"/>
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
                                        <apex:pageBlockSectionItem >
                                            <apex:outputLabel value="Last Modified By"/>
                                            <apex:outputPanel >
                                                <apex:outputField value="{!item.crLine.LastModifiedBy.Name}"/>,&nbsp;<apex:outputField value="{!item.crLine.LastModifiedDate}"/>
                                            </apex:outputPanel>
                                        </apex:pageBlockSectionItem>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                            </td>
                            </tr>
                        </apex:outputPanel>
                        
                        <apex:outputPanel rendered="{!!item.isSummary && !item.isDetail}" >
                            <tr>
                            <td>
                                <apex:commandButton id="saveSolButton" status="saveStatus" value="Save" action="{!saveSolLine}" rendered="{!addReqLine}"/>
                                <apex:commandButton id="saveAndNewSolButton" status="saveStatus" value="Save&New" action="{!saveAndNewSolLine}" rendered="{!addReqLine}"/>
                                <apex:commandButton id="cancelSolButton" value="Cancel" immediate="true" action="{!cancelSolLine}" rendered="{!addReqLine}"/>
                                
                                <apex:commandLink id="saveSolLink" value="Save" action="{!saveSolLine}" styleClass="btn" style="text-decoration:none;padding:4px;margin-top:2px;margin-bottom:2px;margin-right:2px;" rendered="{!!addReqLine}">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                <apex:commandLink id="saveAndNewSolLink" value="Save&New" action="{!saveAndNewSolLine}" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;" rendered="{!!addReqLine}">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                <apex:commandLink id="cancelSolLink" value="Cancel" immediate="true" action="{!cancelSolLine}" styleClass="btn" style="text-decoration:none;padding:4px;margin:2px;" rendered="{!!addReqLine}">
                                    <apex:param name="solId" value="{!item.crLine.Id}"/>
                                </apex:commandLink>
                                
                            </td>
                            <td colspan="11">
                                <!-- 
                                <apex:pageBlock title="{!item.crLine.Name}" mode="edit" rendered="{!item.crLine.Name!=null}">
                                    <apex:pageBlockSection title="Information" columns="2" collapsible="false">
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project_Task__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Backcharge__c}"/>
                                        <apex:inputField value="{!item.crLine.Development_Cost__c}"/>
                                        <apex:inputField value="{!item.crLine.Backcharge_To__c}"/>
                                        <apex:inputField value="{!item.crLine.Development_Cost_Line_Item__c}"/>
                                        <apex:inputField value="{!item.crLine.Tax_Group__c}"/>
                                        <apex:inputField value="{!item.crLine.Not_To_Exceed__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Sales_Tax_Rate_Percent__c}"/>
                                        <apex:outputField value="{!item.crLine.Con_Req_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.RecordTypeId}"/>
                                        <apex:inputField value="{!item.crLine.Site__c}" />
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection title="Product Information" columns="2" collapsible="false">
                                        
                                        <apex:pageBlockSectionItem rendered="{!item.isMajorComponent}">
                                            <apex:outputLabel value="Product"/>
                                            <apex:outputPanel styleClass="requiredInput" layout="block">  
                                                <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                                                <apex:selectList value="{!item.crLine.Opportunity_Product__c}" size="1" >
                                                    <apex:selectOptions value="{!ProjProducts}"/>
                                                </apex:selectList>
                                                <apex:outputPanel styleClass="errorMsg" layout="block" rendered="{!item.isProductError}">
                                                    <strong>Error:</strong> You must enter a value
                                                </apex:outputPanel>
                                            </apex:outputPanel>             
                                        </apex:pageBlockSectionItem>
                                        
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Product__c}" required="true" rendered="{!!item.isMajorComponent}"/>
                                        <apex:inputField value="{!item.crLine.Racking_Watts__c}" rendered="{!!isServiceVisit}"/>
                                        <apex:inputField value="{!item.crLine.Unit_Cost__c}" required="true" rendered="{!isServiceVisit}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Unit_Cost__c}" required="true" rendered="{!!isServiceVisit}"/>
                                        <apex:inputField value="{!item.crLine.Freight__c}" rendered="{!!isServiceVisit}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project__c}"/>
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection columns="1" collapsible="false">
                                        <apex:inputField value="{!item.crLine.Additional_Notes__c}" required="true" style="width:450px; height:120px"/>
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection title="Procurement Information" columns="2" collapsible="false">
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Purchase_Order_Line__c}"/>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                                -->
                                
                                <apex:pageBlock title="Add/Edit Requisition Line" mode="edit" rendered="{!!isServiceVisit}">
                                    <apex:pageBlockSection title="Information" columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.Name}" rendered="{!item.crLine.Name!=null}"/>
                                        <apex:outputText value="New Requisition Line" rendered="{!item.crLine.Name==null}"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project_Task__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Backcharge__c}"/>
                                        <apex:inputField value="{!item.crLine.Development_Cost__c}"/>
                                        <apex:inputField value="{!item.crLine.Backcharge_To__c}"/>
                                        <apex:inputField value="{!item.crLine.Development_Cost_Line_Item__c}"/>
                                        <apex:inputField value="{!item.crLine.Tax_Group__c}"/>
                                        <apex:inputField value="{!item.crLine.Not_To_Exceed__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Sales_Tax_Rate_Percent__c}"/>
                                        <apex:outputField value="{!item.crLine.Con_Req_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.RecordTypeId}"/>
                                        <apex:inputField value="{!item.crLine.Site__c}" />
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection title="Product Information" columns="2" collapsible="false">
                                    <apex:inputField value="{!item.crLine.AcctSeedERP__Product__c}" required="true" rendered="{!item.isOtherComponent}"/>
                                        
                                        <apex:pageBlockSectionItem rendered="{!item.isMajorComponent}">
                                            <apex:outputLabel value="Product"/>
                                            <apex:outputPanel styleClass="requiredInput" layout="block">  
                                                <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                                                <apex:selectList value="{!item.crLine.Opportunity_Product__c}" size="1" >
                                                       <!--  <apex:actionSupport event="onchange" action="{!selectedproducts}"/> -->

                                                    <apex:selectOptions value="{!ProjProducts}"/>
                                                </apex:selectList>
                                                <apex:outputPanel styleClass="errorMsg" layout="block" rendered="{!item.isProductError}">
                                                    <strong>Error:</strong> You must enter a value
                                                </apex:outputPanel>
                                            </apex:outputPanel> 
                                            </apex:pageBlockSectionItem>
                                            
                                            
                                            <apex:pageBlockSectionItem rendered="{!item.isMinorComponent}">
                                            <apex:outputLabel value="Product"/>
                                            <apex:outputPanel styleClass="requiredInput" layout="block">  
                                                <apex:outputPanel styleClass="requiredBlock" layout="block"/>
                                                <apex:selectList value="{!item.crLine.Opportunity_Product__c}" size="1" >
                                                       <!--  <apex:actionSupport event="onchange" action="{!selectedproducts}"/> -->

                                                    <apex:selectOptions value="{!ProjProducts}"/>
                                                </apex:selectList>
                                                <apex:outputPanel styleClass="errorMsg" layout="block" rendered="{!item.isProductError}">
                                                    <strong>Error:</strong> You must enter a value
                                                </apex:outputPanel>
                                            </apex:outputPanel> 
                                            </apex:pageBlockSectionItem>
                                        
                                        
                                        <apex:inputField value="{!item.crLine.Racking_Watts__c}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Unit_Cost__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Freight__c}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project__c}"/>
                                        <apex:inputField value="{!item.crLine.Sub_vendor_Account__c}"/>
                                        
                                        
                                                     
                                       <!--</apex:pageBlockSectionItem>-->
                                        <!--<apex:inputField value="{!item.crLine.AcctSeedERP__Product__c}" required="true" rendered="{!!item.isMinorComponent }"/>-->
                                        
                                        
                                         
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection columns="1" collapsible="false">
                                        <apex:inputField value="{!item.crLine.Vendor_Description_SOL__c}"/>
                                        <apex:inputField value="{!item.crLine.Additional_Notes__c}" required="true" style="width:450px; height:120px"/>
                                    </apex:pageBlockSection>
                                    <apex:pageBlockSection title="Procurement Information" columns="2" collapsible="false">
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Purchase_Order_Line__c}"/>
                                    </apex:pageBlockSection>
                                </apex:pageBlock>
                                 
                                    
                                   
                                
                                <apex:pageBlock title="Add/Edit Requisition Line" mode="edit" rendered="{!isServiceVisit}">
                                    <apex:pageBlockSection title="Information" columns="2" collapsible="false">
                                        <apex:outputField value="{!item.crLine.Name}" rendered="{!item.crLine.Name!=null}"/>
                                        <apex:outputText value="New Requisition Line" rendered="{!item.crLine.Name==null}"/>
                                        <apex:outputField value="{!item.crLine.Status__c}"/>
                                        <apex:outputField value="{!item.crLine.Con_Req_Group__c}"/>
                                        <apex:outputField value="{!item.crLine.RecordTypeId}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project__c}"/>
                                        <apex:inputField value="{!item.crLine.Tax_Group__c}"/>
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Project_Task__c}" required="true"/>
                                        <apex:inputField value="{!item.crLine.Sales_Tax_Rate_Percent__c}"/>
                                        <apex:inputField value="{!item.crLine.Tax_Category__c}" required="true"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Quantity_Ordered__c}" required="true"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.Unit_Cost__c}" required="true"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.AcctSeedERP__Product__c}" required="true"/>
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.Sub_vendor_Account__c }" />
                                        <apex:pageBlockSectionItem />
                                        <apex:inputField value="{!item.crLine.Not_To_Exceed__c}" required="true"/>
                                    </apex:pageBlockSection>
                                    
                                    <apex:pageBlockSection columns="1" collapsible="false">
                                        <apex:inputField value="{!item.crLine.Additional_Notes__c}"/>
                                    </apex:pageBlockSection>

                                </apex:pageBlock>
                                
                            </td>
                            </tr>
                        </apex:outputPanel>
                        
                    </apex:repeat>
                    </apex:outputPanel>
                    
                </table>
            </apex:outputPanel>
                
        </apex:pageBlock>
        
    </apex:form>
    
    <apex:relatedList list="AttachedContentDocuments"/>
    <apex:relatedList list="Requisition_Forms__r" />
    <apex:relatedList list="ProcessSteps" />
    

    
</apex:page>